---
title: "R, una recorrida"
author: "Juan Manuel Barreneche"
date: "4 de Octubre de 2018"
output:
  html_document:
    df_print: paged
    highlight: zenburn
    number_sections: yes
    theme: cerulean
    toc: yes
    toc_float: yes
  html_notebook:
    highlight: zenburn
    number_sections: yes
    theme: cerulean
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
library(tidyverse)
```

# Primero las presentaciones

## Qu? es R

Se puede encontrar por ah? que R es un "Ambiente de computaci?n estad?stica". Con esto quieren decir muchas cosas, pero sobre todo R es:

- Un lenguaje de programaci?n
- Una serie de "paquetes" (funcionalidades) con soluciones para un amplio rango de tareas estad?sticas, incluyendo modelaci?n, aprendizaje autom?tico, clasificaci?n, etc.
- Trabajar con tablas de datos complejas, siguiendo una l?gica similar a una base de datos (ie: tablas con columnas de distinto tipo, como pueden ser num?ricas, texto, fechas, etc...).
- Herramientas gr?ficas poderosas para visualizar la informaci?n.


## R como herramienta

> Cada herramienta para la tarea que fue concebida.

R est? concebido para estad?stica y an?lisis de datos y, como tal, hacemos bien en usarlo para este cometido, combin?ndolo con otras herramientas que son las indicadas para diferentes tareas (ej.: seremos mucho m?s productives usando un SIG para trabajar con mapas, a?n si [hay formas de usar R para esto](https://pakillo.github.io/R-GIS-tutorial/)*).

(*: No queremos decir con esto que sea necesariamente malo usar R para trabajar con SIG, o cualquier otra tarea, solo que en general recomendamos usar la herramienta correcta para cada cometido.)

R se caracteriza por tener muchas funcionalidades a disposici?n y muchas formas de lograr el miso resultado (punto que genera alguna discordia entre la comunidad de usuaries). El lado positivo es que ofrece una gran flexibilidad y permite a cada qui?n encontrar su forma de hacer las cosas. Por otro lado esto tambi?n puede generar desconcierto, especialmente en principiantes.

Como todo en la vida, hay que buscar un balance entre costos y beneficios, y R no es la excepci?n.

### Costos:

Hay que ser baqueane: R requiere un cierto manejo m?nimo para poder explotar sus potencialidades. Para un mortal cualquiera, es como empezar a andar en bici sin rueditas luego de usarlas toda la vida.

> R nos da todos los ingredientes para hacer lo que querramos... s?lo faltan las instrucciones!

---

![Haz tu propia torta! (autor: la internet)](img_clase1/torta.jpg)

---

La realidad es que hay m?s instrucciones disponibles de lo que parece al principio, y en verdad R nos proporciona muchas herramientas muy elaboradas para hacer lo que precisamos, las cuales se potencian cuando las empezamos a combinar.

> En otras palabras, *no es tan as?*.

De todas formas, si bien la forma de interactuar con R ha evolucionado mucho en los ?ltimos a?os (ej: RStudio), sigue siendo desafiante y contraintuitivo en los primeros pasos. Una fuente de frustraci?n frecuente es que exige mucha precisi?n a la hora de escribr los comandos. Otra es el enigm?tico lenguaje en que se expresa toda la informaci?n, desde los comandos hasta la documentaci?n, pasando por los mensajes de error y de advertencia.

### Beneficios:

Para empezar, R es **[Software Libre](https://es.wikipedia.org/wiki/Software_libre)**.

Esto implica varias cosas:

- Es gratis.
- Cualquiera puede "ver las [entra?as](https://stat.ethz.ch/R/daily/)" del software.
- Incorpora aportes de la comunidad de usuarios, generalmente en forma de paquetes / bibliotecas (Figura 1), pero tambi?n a trav?s de tutoriales o cursos, muchos de ellos gratuitos.

---

```{r crecimiento_paquetes, warning=FALSE, echo=FALSE, cache=TRUE, fig.cap="Figura 1: durante 20 se ha mantenido un crecimiento exponencial."}
require(ggplot2)
pkgs <- read.csv("data/paquetes.csv")
ggplot(pkgs, aes(as.Date(first_release), index)) +
  geom_line(size = 1.5, col = "skyblue") +
  scale_x_date(date_breaks = '2 year', date_labels = '%Y') +
  scale_y_continuous(breaks = seq(0, 14000, 1000)) +
  xlab('') + ylab('') + theme_bw() +
  ggtitle('N?mero de paquetes de R alguna vez publicados en CRAN')
```



---

Adem?s, R proporciona una **enorme flexibilidad**: *el cielo es el l?mite*.

Por ?ltimo, todes contamos con el **apoyo de una gran comunidad de usuaries**: la adopci?n de R como lingua franca en estad?stica a trav?s de continentes y disciplinas ha sido explosiva en la ?ltima d?cada. Esta comunidad se caracteriza, como tantas otras en Software Libre, por una gran solidaridad para ayudar a qui?nes lo necesitan. En la pr?ctica, esto se traduce en listas de mail, foros y comunidades dedicadas al tema (ej: [R-Ladies Montevideo](https://twitter.com/RLadiesMVD)). [M?s info ac?](https://www.r-project.org/help.html).

Recomendaci?n: explorar [datacamp.com](https://www.datacamp.com/community/open-courses), puede que encuentren alg?n [curso de R en espa?ol](https://www.datacamp.com/community/open-courses/introduccion-a-r).

## Evoluci?n de R y su interfaz:

El R fue creado hace unos 20 a?os aproximadamente, basado en S+, un software propietario con los mismos fines y sintaxis similar.

-------

![S+, el abuelo de R.](img_clase1/splus.gif)

Durante mucho tiempo mantuvo una interfaz gr?fica (GUI) muy b?sica (en Windows, en Linux era m?s que nada usado en la l?nea de comandos o CLI).

------

![R solito, no tan amigable.](img_clase1/Annotated_R_Interface.jpg)

-------

Desde el 2011 existe un entorno de desarrollo integrado (IDE) que r?pidamente se populariz?, convirti?ndose pr?cticamente en la interfaz est?ndar entre la comunidad de usuarios de R.

-------

![RStudio, el IDE que el pueblo ped?a.](img_clase1/rstudio.png)

-------

No conformes con reconfigurar la forma en que interactuamos con R a nivel de IDE, esta gente ha desarrollado un conjunto de paquetes "con opiniones fuertes", que est? dise?ado para trabajar bien en conjunto. Este conjunto se a dado a llamar **tidyverse**, y al igual que RStudio, ha ganado mucha popularidad.

-------

![Las opiniones de tidyverse no necesariamente reflejan las nuestras.](img_clase1/tidyverse2.png)

-------

![No se peleen gurises que ac? estamos entre amigues.](img_clase1/tidyverse_rbasic.jpg)

-------


# Conceptos y comandos b?sicos

## Primeros pasos

Lo m?s sencillo tal vez sea escribir una suma y ejecutarla:

```r
1 + 1
```

(Escribir el comando / expresi?n que queremos ejecutar y apretar Enter)

Al hacer esto R nos da inmediatamente el resultado, usando una codificaci?n para distinguir comandos (input; entradas) de resultados (output; salidas):

```r
> 1 + 1
[1] 2
```

El input es `1 + 1` y el output es 2. El `[1]` que all? aparece indica que 2 es el primer elemento de la salida.

Si nuestro comando est? incompleto, R nos indica que hay que seguir escribiendo, con el prompt `+`:

```r
> 1 + 1 + 89 + 5 * 3 +
+ 
```

Otra cosa muy ?til es que l?s ?rdenes se pueden reciclar: la historia de comandos se guarda autom?ticamente y se puede recorrer con las flechas hacia arriba y hacia abajo. En RStudio adem?s hay una ventanita en la que podemos ir viendo esa historia a medida que ejecutamos comandos.

> Navergar por la historia de comandos ejecutados.

> Experimentar con algunos comandos m?s:

```r
sqrt(2)
rnorm(50)
plot(rnorm(50))
?rnorm
```


## Guiones (scripts)

La din?mica de trabajo t?pica con R involucra el uso de guiones, que no son otra cosa que archivos de texto plano con una serie de comandos de R.

> Un formato de texto plano conocido es el `.txt`, as? como los `.csv`; la extensi?n no es m?s que un detalle. En el caso de R, se utilizan las extensiones `.R` o `.r`.

Los guiones nos permiten ir guardando nuestro trabajo y volver a utilizarlo cuando precisemos. Tambi?n facilitan el compartir con otras personas este trabajo. Los comandos contenidos en ellos conforman el llamado **[c?digo fuente](https://es.wikipedia.org/wiki/C%C3%B3digo_fuente)** (source code, en ingl?s).

-------

![Un gui?n o c?digo fuente en RStudio.](img_clase1/rstudio_guion.png)

-------

Con la popularizaci?n de RStudio, la forma de interactuar con los guiones cambi? bastante, debido a una simple combinaci?n de teclado:

    Ctrl + Enter

Probemos algunos ejemplos, cada uno en su PC:

```r
1 + 1
sqrt(9)
log(76)
exp(46 * 4 - 1)
```

La idea de este comando es ir avanzando l?nea a l?nea por nuestro c?digo fuente, contenido en el gui?n de R.

Otras facilidades de RStudio:

- **Ejecutar c?digo seleccionado**: si sombreamos un pedazo de c?digo y apretamos `Ctrl + Enter`, ejecuta s?lo esa parte.
- **Autocompletado**: a medida que escribimos un nombre nos sugiere opciones para completar (ej.: `col...`). Usar tecla "tab" (indentaci?n).
- **Argumentos de las funciones**: cuando escribimos una funci?n nos muestra los argumentos que lleva (ej.: `log`). Usar tecla "tab" (indentaci?n).
- **Otras**: navegaci?n por el gui?n, "embellecer c?digo", atajos (`Alt + Shift + k`) y m?s ...

M?s info: [curso R](https://github.com/jumanbar/Curso-R/blob/master/lecciones/1.4-scripts-y-directorio-de-trabajo.markdown)

## Sesi?n de R

Al abrir R siempre se inicia una nueva sesi?n (o se carga una anterior). Una sesi?n est? compuesta por el conjunto de objetos que nosotres *cargamos* en ella. Un ejemplo bien simple es crear un objeto, usando la asignaci?n `<-` (`=` tambi?n funciona):

```{r}
x <- 5
```

Luego de ejectuar este comando, podemos utilizar al objeto `x` en futuros comandos. Por ejemplo:

```{r}
x * 4
```

Los objetos de la sesi?n se pueden ver con el comando `ls()`, o mirando la secci?n "Ambiente" de la ventana de RStudio. En caso de querer eliminar un objeto de nuestra sesi?n, usamos la funci?n `rm` (ejemplo: `rm(x)`).

---

![Una ojeada a la sesi?n de R, en RStudio.](img_clase1/rstudio_ambiente.png)

---


A los objetos que creamos se le suman aquellos paquetes que cargamos con el comando `library()`.


```{r}
library(readxl) # Probar con otros paquetes, si este no funciona
```


Aqu? tambi?n nos auxilia la interfaz de RStudio, gracias a la ventana "paquetes", que nos lista los paquetes dispoinbles y aquellos que ya est?n cargados en nuestra sesi?n.




---

![Ventana de paquetes en RStudio.](img_clase1/rstudio_paquetes.png)

# R y tu: como construir un buen v?nculo

El objetivo de esta clase es facilitar la adopci?n de R como una herramienta m?s en el repertorio de cada une.

## Puntos clave para llevarse bien con R:

- Utilizar la ayuda
- Utilizar Google
- Utilizar la ayuda
- *Leer detenidamente los mensajes de error*
- Preguntar
- Probar
- Utilizar la ayuda

> Es posible que hayamos repetido algunos ?tems

## Utilizando la ayuda

En ingl?s se populariz? la sigla RTFM (Read The Fucking Manual). M?s all? de que tiene m?s agresividad verbal de la necesaria, expresa con claridad una sensaci?n: de que nadie se toma trabajo para leer manuales.

> Que por otro lado, es entendible

Insistimos en apoyarse en la ayuda porque es lo que hacemos en la pr?ctica. En nuestra experiencia, R tiene de las mejores documentaciones disponibles, cubriendo:

- **Funciones**: cada funci?n tiene una p?gina de documentaci?n en la que idealmente se explican todos los requisitos, opciones y comportamientos de la misma.
- **Temas**: hay funcionalidades que se engloban dentro de un tema o una tarea y tambi?n tienen su p?gina dedicada (ej.: [control de flujo](https://es.wikipedia.org/wiki/Estructuras_de_control)).
- **Conjuntos de datos**: datos que vienen incluidos en el R b?sico o en paquetes agregados (ejs.: `iris`, `cars`).


Todas las p?ginas de ayuda de R est?n estructuradas de la misma manera, lo cual es de gran utilidad para le usuarie. Empezamos con el caso de las funciones ya que en general incluyen casi todas las secciones est?ndar de la documentaci?n.

### Documentaci?n de funciones

Uno de los comandos que m?s usamos los usuarios de R es `help`. El mismo se puede usar de varias formas:

```r
help(sort)
?sort
?"sort"
```

En los tres ejemplos lo que se est? pidiendo es que se abra la p?gina de ayuda de la funci?n `sort`. Este tipo de documento tienen varias secciones, siempre ordenadas de la misma manera y con una estructura predeterminada, m?s all? de que no siempre est?n todas. Haciendo un breve resumen, se trata de:

- **Nombre, t?tulo y descripci?n**: una sin?psis de lo que hace la funci?n. En general "Description" es el punto m?s informativo.
- **Uso**: muestra como se estructura un *llamado* a la funci?n, incluyendo los argumentos, valores por defecto y m?todos por defecto.
- **Argumentos**: una lista de los argumentos de la funci?n con una descripci?n para cada uno. Importante para entender qu? es lo que la funci?n espera como *entrada* (ie: no podemos darle tomates si lo que espera son lechugas).
- **Detalles**: se trata de una secci?n gen?rica de texto, que puede tener mucha o poca informaci?n. Es muy ?til para entender los comportamientos de la funci?n en distintas situaciones.
- **Valor**: es una descripci?n de la *salida* de la funci?n. Tambi?n puede explicar comportamientos para distintas situaciones. Si esper?bamos bo?atos y nos est? dando papas, aqu? deber?a estar la explicaci?n.
- **Referencias**: referencias bibliogr?ficas utilizadas en el texto.
- **Ver tambi?n**: otras p?ginas de ayuda (de temas o funciones) que est?n vinculadas a la actual y que nos pueden ser ?tiles o de inter?s.
- **Ejemplos**: bloques de c?digo que podemos ejecutar en la consola para ver ejemplos de la funci?n en acci?n. Se pueden correr tambi?n usando la funci?n **`example`** (a menos que sea un bloque iniciado por la l?nea `## Not run:`).

### Documentaci?n de temas y datasets

Podemos probar con el siguiente comando:

```r
?Distributions
```

Se trata de una p?gina de ayuda est?ndar, pero enfocada en una tem?tica en particular (en el ejemplo, las funciones para trabajar con [distribuciones de probabilidad](https://es.wikipedia.org/wiki/Distribuci%C3%B3n_de_probabilidad) incluidas en el paquete `stats`). Pueden faltar secciones, como "Argumentos", que no tienen sentido ser incluidas aqu?.

Por otro lado, los conjuntos de datos, o datasets, tambi?n tienen sus propias p?ginas de ayuda. Se trata generalmente de tablas con datos que sirven de ejemplo para ilustrar funcionalidades de R y/o paquetes agregados. Uno de los ejemplos m?s cl?sicos es:

```r
?iris # Edgar Anderson's Iris Data
```

M?s info: [curso R](https://github.com/jumanbar/Curso-R/blob/master/lecciones/1.3-uso-de-la-ayuda.markdown)

## Mensajes de error

En la experiencia de quien est? aprendiendo R, o cualquier lenguaje de programaci?n, los mensajes de error son una de las cosas m?s temidas. Sin embargo, pueden ser muy ?tiles si decodificamos la informaci?n que nos brinda.

Estos mensajes se pueden clasificar en las siguientes categor?as:

- **Errores de sintaxis**: ocurren cuando una sentencia est? incorrectamente estructurada. Ejemplos t?picos son la falta de una coma o un par?ntesis.
- **Objetos no encontrados**: los cuales ocurren cuando
    + El nombre de un objeto no se escribi? correctamente. Un caso t?pico es poner mal may?sculas o min?sculas.
    + El paquete o archivo que contiene al objeto no ha sido cargado a?n.
    + Faltaron comillas en el lugar que corresponde.
    + Alg?n otro motivo (use la imaginaci?n).
- **Otras causas**: en cuyo caso suele ser muy ?til la funci?n `traceback`.

Para enfrentar estos casos, lo mejor es evitar que ganen los nervios y leer detenidamente los mensajes, buscando encontrar cu?l de estas fuentes es la m?s probable. Sin dudas que la experiencia ayuda mucho en estas situaciones.

Tambi?n es muy ?til utilizar google u otros buscadores: copiar el mensaje de error y buscar en internet, en lo posible omitiendo las partes que son espec?ficas de nuestra situaci?n particular.

Como mencion?bamos antes, tambi?n es importante probar, experimentar, para determinar cu?l es el problema (por ejemplo, quitando partes al c?digo que genera el error, hasta quedar con lo m?nimo necesario para reproducirlo).

En ?ltimo t?rmino, est? la posibilidad de pedir ayuda, tanto a personas que conocemos como a comunidades en internet (ej.: stackoverflow). Esto ya lo mencionamos en esta misma clase (ver secci?n "Beneficios").

## Aplicado estos conceptos a un ejemplo

```r
> plot(sort(rnorm(60)), pch=8, col=red, xlab="Rank",
+ ylab="Variable Gaussiana")
Error in plot.xy(xy, type, ...) : object 'red' not found

> plot(sort(rnorm(60)), pch=8, col="red", xlab="Rank"
+ ylab="Variable Gaussiana")
Error: unexpected symbol in:
"plot(sort(rnorm(200)), pch=8, col="red", xlab="Rank"
ylab"

> plot(sort(rnorm(60)), pch=8, col="red", xlab="Rank",
+ xlab="Variable Gaussiana")
Error in plot.default(sort(rnorm(200)), pch = 8, col = "red", xlab = "Rank",  : 
  formal argument "xlab" matched by multiple actual arguments
```

Y sin embargo el siguiente comando s? est? escrito correctamente:

```{r 3_errores_solucionado, fig.cap="Figura 2: Al fin sali? la figura."}
plot(sort(rnorm(60)), pch=8, col="red", xlab="Rank",
ylab="Variable Gaussiana")
```

------





